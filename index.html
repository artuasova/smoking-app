import React, { useState, useEffect, useRef } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { motion } from 'framer-motion';
import { 
  Settings, 
  BarChart2,
  Plus,
  Minus,
  LogOut,
  RefreshCw,
  Download,
  Trash2,
  User,
  Clock,
  DollarSign,
  Medal,
  ChevronLeft,
  ChevronRight,
  Database,
  Zap,
  AlertTriangle,
  CheckCircle,
  XCircle
} from 'lucide-react';

const App = () => {
  // Initial state
  const [data, setData] = useState({
    today: 0,
    week: 0,
    month: 0,
    goal: 20,
    packPrice: 250,
    cigarettesPerPack: 20,
    streak: 0,
    lastDate: null,
    timeStats: [],
    lastAutoResetDate: new Date().toDateString(),
    achievements: [
      { id: 1, name: "–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å", target: 1, achieved: false, icon: "üìÖ" },
      { id: 2, name: "–ù–µ–¥–µ–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—é", target: 7, achieved: false, icon: "üóìÔ∏è" },
      { id: 3, name: "–ú–µ—Å—è—Ü –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–µ—Å—è—Ü", target: 30, achieved: false, icon: "üìÜ" },
      { id: 4, name: "100 —Å–∏–≥–∞—Ä–µ—Ç", description: "–í—ã–∫—É—Ä–∏—Ç—å 100 —Å–∏–≥–∞—Ä–µ—Ç", target: 100, achieved: false, icon: "üö¨" },
      { id: 5, name: "–≠–∫–æ–Ω–æ–º–∏—è –∑–¥–æ—Ä–æ–≤—å—è", description: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –Ω–∞ 50% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –Ω–µ–¥–µ–ª–µ–π", target: 50, achieved: false, icon: "üíö" }
    ],
    totalCost: 0,
    usageDays: 0,
    firstUseDate: new Date().toDateString(),
    lastCigaretteTime: null
  });
  
  const [syncStatus, setSyncStatus] = useState({ status: 'idle', message: '' });
  const [user, setUser] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [showStatsModal, setShowStatsModal] = useState(false);
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [isRegistration, setIsRegistration] = useState(false);
  const [isForgotPassword, setIsForgotPassword] = useState(false);
  const [authEmail, setAuthEmail] = useState('');
  const [authPassword, setAuthPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [activeChart, setActiveChart] = useState('weekday');
  const [timeDetails, setTimeDetails] = useState({ 
    week: false, 
    month: false, 
    all: false 
  });
  
  // Medical facts and quotes
  const quotes = [
    "–ö–∞–∂–¥–∞—è –Ω–µ –≤—ã–∫—É—Ä–µ–Ω–Ω–∞—è —Å–∏–≥–∞—Ä–µ—Ç–∞ - —à–∞–≥ –∫ –∑–¥–æ—Ä–æ–≤—å—é!",
    "–í—ã —Å–∏–ª—å–Ω–µ–µ —Å–≤–æ–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏!",
    "–≠–∫–æ–Ω–æ–º–∏—è —Å–µ–≥–æ–¥–Ω—è - –∑–¥–æ—Ä–æ–≤—å–µ –∑–∞–≤—Ç—Ä–∞!",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç –¥–µ–ª–∞–µ—Ç –≤–∞—Å —Å–∏–ª—å–Ω–µ–µ!",
    "–í–∞—à–µ –∑–¥–æ—Ä–æ–≤—å–µ - –≤–∞—à–∞ —Ü–µ–Ω–Ω–æ—Å—Ç—å!",
    "–°–∏–ª–∞ –≤–æ–ª–∏ - –∫–ª—é—á –∫ —É—Å–ø–µ—Ö—É!",
    "–ö–∞–∂–¥–∞—è —Å–∏–≥–∞—Ä–µ—Ç–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –Ω–µ –≤—ã–∫—É—Ä–∏–ª–∏ - –ø–æ–±–µ–¥–∞!",
    "–ó–¥–æ—Ä–æ–≤—å–µ –Ω–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å!",
    "–°–µ–≥–æ–¥–Ω—è –≤—ã —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –≤—á–µ—Ä–∞!",
    "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å - —ç—Ç–æ –Ω–æ–≤—ã–π —à–∞–Ω—Å!"
  ];
  
  const medicalFacts = [
    "–ß–µ—Ä–µ–∑ 1 —á–∞—Å –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–≥–∞—Ä–µ—Ç—ã –ø—É–ª—å—Å –∏ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞—é—Ç —Å–Ω–∏–∂–∞—Ç—å—Å—è –¥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è.",
    "–ß–µ—Ä–µ–∑ 2 —á–∞—Å–∞ –ø–µ—Ä–∏—Ñ–µ—Ä–∏—á–µ—Å–∫–∏–µ –∫—Ä–æ–≤–µ–Ω–æ—Å–Ω—ã–µ —Å–æ—Å—É–¥—ã —Ä–∞—Å—à–∏—Ä—è—é—Ç—Å—è, —É–ª—É—á—à–∞–µ—Ç—Å—è —Ü–∏—Ä–∫—É–ª—è—Ü–∏—è –∫—Ä–æ–≤–∏ –≤ —Ä—É–∫–∞—Ö –∏ –Ω–æ–≥–∞—Ö.",
    "–ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞ —É—Ä–æ–≤–µ–Ω—å –Ω–∏–∫–æ—Ç–∏–Ω–∞ –≤ –∫—Ä–æ–≤–∏ —Å–Ω–∏–∂–∞–µ—Ç—Å—è –¥–æ –Ω—É–ª—è, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞.",
    "–ß–µ—Ä–µ–∑ 4 —á–∞—Å–∞ —É–ª—É—á—à–∞–µ—Ç—Å—è –Ω–∞—Å—ã—â–µ–Ω–∏–µ –∫—Ä–æ–≤–∏ –∫–∏—Å–ª–æ—Ä–æ–¥–æ–º, —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∏—Å–∫ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—É–ø–∞.",
    "–ß–µ—Ä–µ–∑ 5 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–∏–∑–∏—Å—Ç–æ–π –æ–±–æ–ª–æ—á–∫–∏ –Ω–æ—Å–æ–≥–ª–æ—Ç–∫–∏ –∏ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π.",
    "–ß–µ—Ä–µ–∑ 6 —á–∞—Å–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è –≤–∫—É—Å –∏ –æ–±–æ–Ω—è–Ω–∏–µ, –æ—Ä–≥–∞–Ω–∏–∑–º –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Ç–æ–∫—Å–∏–Ω—ã.",
    "–ß–µ—Ä–µ–∑ 7 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ç–µ–ª–∞, —É–ª—É—á—à–∞–µ—Ç—Å—è –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ.",
    "–ß–µ—Ä–µ–∑ 8 —á–∞—Å–æ–≤ —É—Ä–æ–≤–µ–Ω—å –æ–∫—Å–∏–¥–∞ —É–≥–ª–µ—Ä–æ–¥–∞ –≤ –∫—Ä–æ–≤–∏ —Å–Ω–∏–∂–∞–µ—Ç—Å—è, –∫–∏—Å–ª–æ—Ä–æ–¥–Ω–æ–µ –Ω–∞—Å—ã—â–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è.",
    "–ß–µ—Ä–µ–∑ 9 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –ª–µ–≥–∫–∏—Ö, —É–ª—É—á—à–∞–µ—Ç—Å—è –¥—ã—Ö–∞–Ω–∏–µ.",
    "–ß–µ—Ä–µ–∑ 10 —á–∞—Å–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞, —É–ª—É—á—à–∞–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.",
    "–ß–µ—Ä–µ–∑ 11 —á–∞—Å–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –ø–∏—â–µ–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ç–æ—à–Ω–æ—Ç–∞.",
    "–ß–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –æ—Ä–≥–∞–Ω–∏–∑–º –±–æ—Ä–µ—Ç—Å—è —Å –∏–Ω—Ñ–µ–∫—Ü–∏—è–º–∏.",
    "–ß–µ—Ä–µ–∑ 13 —á–∞—Å–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è –∫—Ä–æ–≤–æ—Ç–æ–∫ –≤ –º–æ–∑–≥–µ, –ø–æ–≤—ã—à–∞–µ—Ç—Å—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≤–Ω–∏–º–∞–Ω–∏—è.",
    "–ß–µ—Ä–µ–∑ 14 —á–∞—Å–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —É–ª—É—á—à–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞.",
    "–ß–µ—Ä–µ–∑ 15 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–µ—Ç–æ–∫ –ø–µ—á–µ–Ω–∏, —É–ª—É—á—à–∞–µ—Ç—Å—è –º–µ—Ç–∞–±–æ–ª–∏–∑–º.",
    "–ß–µ—Ä–µ–∑ 16 —á–∞—Å–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –∫–∞—à–ª—è, —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –æ–¥—ã—à–∫–∞.",
    "–ß–µ—Ä–µ–∑ 17 —á–∞—Å–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —Å–µ—Ä–¥—Ü–∞, —Å–Ω–∏–∂–∞–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –æ—Ä–≥–∞–Ω.",
    "–ß–µ—Ä–µ–∑ 18 —á–∞—Å–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫—É—Å–æ–≤—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ—Ä–æ–≤, –µ–¥–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∫—É—Å–Ω–µ–µ.",
    "–ß–µ—Ä–µ–∑ 19 —á–∞—Å–æ–≤ —É–ª—É—á—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ –ø–æ—á–µ–∫, –æ—Ä–≥–∞–Ω–∏–∑–º –ª—É—á—à–µ –≤—ã–≤–æ–¥–∏—Ç —Ç–æ–∫—Å–∏–Ω—ã.",
    "–ß–µ—Ä–µ–∑ 20 —á–∞—Å–æ–≤ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Ä–∏—Å–∫ –∏–Ω—Å—É–ª—å—Ç–∞, —É–ª—É—á—à–∞–µ—Ç—Å—è –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ –º–æ–∑–≥–µ.",
    "–ß–µ—Ä–µ–∑ 21 —á–∞—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, —É–ª—É—á—à–∞–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è.",
    "–ß–µ—Ä–µ–∑ 22 —á–∞—Å–∞ —É–ª—É—á—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞ —ç–Ω–¥–æ–∫—Ä–∏–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –≥–æ—Ä–º–æ–Ω—ã.",
    "–ß–µ—Ä–µ–∑ 23 —á–∞—Å —Å–Ω–∏–∂–∞–µ—Ç—Å—è –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ, —É–ª—É—á—à–∞–µ—Ç—Å—è –æ–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.",
    "–ß–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –æ—Ä–≥–∞–Ω–∏–∑–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç –Ω–∏–∫–æ—Ç–∏–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ."
  ];
  
  const [randomQuote, setRandomQuote] = useState(quotes[0]);
  const timerRef = useRef(null);
  
  // Initialize app
  useEffect(() => {
    loadData();
    checkSession();
    const timer = setInterval(() => {
      updateTimer();
    }, 1000);
    timerRef.current = timer;
    
    // Setup auto reset check
    const resetInterval = setInterval(checkForAutoReset, 60000);
    
    return () => {
      clearInterval(timer);
      clearInterval(resetInterval);
    };
  }, []);
  
  // Update UI when data changes
  useEffect(() => {
    updateUI();
  }, [data]);
  
  // Show random quote on mount
  useEffect(() => {
    setRandomQuote(quotes[Math.floor(Math.random() * quotes.length)]);
  }, []);
  
  // Calculate statistics
  const calculateLastXPeriod = (days) => {
    if (data.timeStats.length === 0) return 0;
    
    const now = new Date();
    const xDaysAgo = new Date(now);
    xDaysAgo.setDate(xDaysAgo.getDate() - days);
    xDaysAgo.setHours(0, 0, 0, 0);
    
    return data.timeStats.filter(stat => {
      const statDate = new Date(stat.timestamp);
      return statDate >= xDaysAgo;
    }).length;
  };
  
  // Update UI values
  const updateUI = () => {
    setData(prev => ({
      ...prev,
      week: calculateLastXPeriod(7),
      month: calculateLastXPeriod(30)
    }));
  };
  
  // Update timer
  const updateTimer = () => {
    if (data.lastCigaretteTime) {
      const now = new Date();
      const lastTime = new Date(data.lastCigaretteTime);
      const diff = now - lastTime;
      
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      // Medical fact logic can be implemented here
    }
  };
  
  // Auto reset logic
  const getNextResetTime = () => {
    const now = new Date();
    const nextReset = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 6, 0, 0, 0);
    
    if (now >= nextReset) {
      nextReset.setDate(nextReset.getDate() + 1);
    }
    
    return nextReset;
  };
  
  const performAutoReset = () => {
    setData(prev => {
      const now = new Date();
      const startOfTodayPeriod = new Date(now);
      startOfTodayPeriod.setHours(6, 0, 0, 0);
      const endOfTodayPeriod = new Date(startOfTodayPeriod);
      endOfTodayPeriod.setDate(endOfTodayPeriod.getDate() + 1);
      endOfTodayPeriod.setMilliseconds(endOfTodayPeriod.getMilliseconds() - 1);
      
      const filteredStats = prev.timeStats.filter(stat => {
        const statTimestamp = stat.timestamp;
        return !(statTimestamp >= startOfTodayPeriod.getTime() && statTimestamp <= endOfTodayPeriod.getTime());
      });
      
      let newLastCigaretteTime = null;
      if (filteredStats.length > 0) {
        newLastCigaretteTime = filteredStats[filteredStats.length - 1].timestamp;
      }
      
      return {
        ...prev,
        today: 0,
        timeStats: filteredStats,
        lastCigaretteTime: newLastCigaretteTime,
        lastAutoResetDate: new Date().toDateString()
      };
    });
  };
  
  const checkForAutoReset = () => {
    const todayString = new Date().toDateString();
    if (data.lastAutoResetDate !== todayString) {
      const now = new Date();
      const nextResetTime = getNextResetTime();
      
      if (now >= nextResetTime || data.lastAutoResetDate === null) {
        performAutoReset();
      }
    }
  };
  
  // Data management
  const loadData = () => {
    try {
      const saved = localStorage.getItem('smokingData');
      if (saved) {
        const parsed = JSON.parse(saved);
        setData(prev => ({
          ...prev,
          ...parsed,
          timeStats: parsed.timeStats || [],
          achievements: parsed.achievements || prev.achievements,
          firstUseDate: parsed.firstUseDate || prev.firstUseDate
        }));
      }
    } catch (e) {
      console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
    }
  };
  
  const saveData = (newData) => {
    try {
      const dataToSave = newData || data;
      localStorage.setItem('smokingData', JSON.stringify(dataToSave));
      localStorage.setItem('smokingApp_lastUpdate', new Date().toISOString());
      // Cloud sync would happen here
    } catch (e) {
      console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
    }
  };
  
  // Authentication methods (simplified for demo)
  const checkSession = () => {
    // This would check actual session in a real app
    const mockUser = {
      id: 'mock-user-id',
      email: 'user@example.com',
      name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
    };
    setUser(mockUser);
  };
  
  const handleAuth = () => {
    // Simplified auth logic
    if (isRegistration) {
      setSyncStatus({ status: 'success', message: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!' });
      setShowAuthModal(false);
      setUser({ email: authEmail, name: authEmail.split('@')[0] });
    } else if (isForgotPassword) {
      setSyncStatus({ status: 'success', message: '–°—Å—ã–ª–∫–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞' });
    } else {
      setUser({ email: authEmail, name: authEmail.split('@')[0] });
      setShowAuthModal(false);
      setSyncStatus({ status: 'success', message: '–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!' });
    }
  };
  
  const logout = () => {
    if (window.confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
      setUser(null);
      setShowAuthModal(true);
      setSyncStatus({ status: 'success', message: '–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞' });
    }
  };
  
  // Counter methods
  const incrementCounter = () => {
    setData(prev => {
      const now = new Date();
      const costPerCigarette = prev.packPrice / prev.cigarettesPerPack;
      
      return {
        ...prev,
        today: prev.today + 1,
        timeStats: [
          ...prev.timeStats,
          {
            time: now.toLocaleTimeString('ru-RU'),
            timestamp: now.getTime(),
            date: now.toDateString()
          }
        ],
        lastCigaretteTime: now.getTime(),
        totalCost: prev.totalCost + costPerCigarette,
        usageDays: prev.lastDate !== now.toDateString() ? prev.usageDays + 1 : prev.usageDays,
        lastDate: now.toDateString()
      };
    });
    
    // Check achievements after update
    setTimeout(checkAchievements, 100);
  };
  
  const decrementCounter = () => {
    setData(prev => {
      if (prev.today === 0) return prev;
      
      const newTimeStats = [...prev.timeStats];
      newTimeStats.pop();
      
      const costPerCigarette = prev.packPrice / prev.cigarettesPerPack;
      let newLastCigaretteTime = prev.lastCigaretteTime;
      
      if (newTimeStats.length > 0) {
        newLastCigaretteTime = newTimeStats[newTimeStats.length - 1].timestamp;
      } else {
        newLastCigaretteTime = null;
      }
      
      return {
        ...prev,
        today: prev.today - 1,
        timeStats: newTimeStats,
        lastCigaretteTime: newLastCigaretteTime,
        totalCost: Math.max(0, prev.totalCost - costPerCigarette)
      };
    });
  };
  
  // Achievements logic
  const checkAchievements = () => {
    setData(prev => {
      const updatedAchievements = prev.achievements.map(achievement => {
        if (!achievement.achieved) {
          let achieved = false;
          
          switch(achievement.id) {
            case 1:
            case 2:
            case 3:
              achieved = prev.usageDays >= achievement.target;
              break;
            case 4:
              achieved = prev.timeStats.length >= achievement.target;
              break;
            case 5:
              if (prev.week > 0 && prev.today > 0) {
                const averageLastWeek = prev.week / 7;
                const reduction = ((averageLastWeek - prev.today) / averageLastWeek) * 100;
                achieved = reduction >= achievement.target;
              }
              break;
          }
          
          if (achieved) {
            // Show notification in real app
            console.log(`Achievement unlocked: ${achievement.name}`);
            return { ...achievement, achieved: true };
          }
        }
        return achievement;
      });
      
      return {
        ...prev,
        achievements: updatedAchievements
      };
    });
  };
  
  // UI helper functions
  const getProgressInfo = () => {
    const percent = Math.round((data.today / data.goal) * 100);
    let message = "–ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–∫–∞–∑–∞ –æ—Ç –∫—É—Ä–µ–Ω–∏—è";
    let emoji = "üòä";
    let isCritical = false;
    let isWarning = false;
    
    if (data.today === 0) {
      message = "–ù–∞—á–Ω–∏ —Å–≤–æ–π –¥–µ–Ω—å —á–∏—Å—Ç—ã–º!";
    } else if (percent < 30) {
      const messages = ["–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ!", "–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏!", "–ú–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!"];
      message = messages[Math.floor(Math.random() * messages.length)];
      emoji = "üôÇ";
    } else if (percent < 50) {
      emoji = "üôÇ";
    } else if (percent < 75) {
      const messages = ["–í—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç–µ—Å—å –∫ –ª–∏–º–∏—Ç—É!", "–ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è!", "–í–Ω–∏–º–∞–Ω–∏–µ: –õ–∏–º–∏—Ç –±–ª–∏–∑–∫–æ!"];
      message = messages[Math.floor(Math.random() * messages.length)];
      emoji = "‚ö†Ô∏è";
      isWarning = true;
    } else if (percent < 100) {
      message = "–õ–∏–º–∏—Ç –ø–æ—á—Ç–∏ –∏—Å—á–µ—Ä–ø–∞–Ω!";
      emoji = "üò®";
      isWarning = true;
    } else if (percent === 100) {
      const messages = ["–õ–∏–º–∏—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏—Å—á–µ—Ä–ø–∞–Ω!", "–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ!", "–ü—Ä–µ–¥–µ–ª –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º—ã!"];
      message = messages[Math.floor(Math.random() * messages.length)];
      emoji = "‚ö†Ô∏è";
      isCritical = true;
    } else {
      const messages = [
        "–õ–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω! –ü–æ–¥—É–º–∞–π –æ –∑–¥–æ—Ä–æ–≤—å–µ!", 
        "–ü–µ—Ä–µ–±–æ—Ä! –û–¥—É–º–∞–π—Å—è!", 
        "–≠—Ç–æ —É–∂–µ –≤—Ä–µ–¥! –•–≤–∞—Ç–∏—Ç!",
        "–°—Ç–æ–ø! –ü–æ–¥—É–º–∞–π –æ —Å–≤–æ–µ–º –∑–¥–æ—Ä–æ–≤—å–µ!"
      ];
      message = messages[Math.floor(Math.random() * messages.length)];
      emoji = "üö®";
      isCritical = true;
    }
    
    return {
      percent: Math.min(100, percent),
      message: `${emoji} ${message}`,
      isWarning,
      isCritical
    };
  };
  
  const getProgressBarColor = (percent) => {
    if (percent <= 50) {
      return 'bg-green-500';
    } else if (percent <= 100) {
      return 'bg-yellow-500';
    } else {
      return 'bg-red-500';
    }
  };
  
  // Chart data preparation
  const getWeekdayChartData = () => {
    const weekdayStats = new Array(7).fill(0);
    const weekdayNames = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
    
    data.timeStats.forEach(stat => {
      const statDate = new Date(stat.timestamp);
      const weekday = statDate.getDay();
      weekdayStats[weekday]++;
    });
    
    return weekdayNames.map((name, index) => ({
      name,
      cigarettes: weekdayStats[index]
    }));
  };
  
  const getDailyChartData = () => {
    const now = new Date();
    const dailyData = [];
    
    for (let i = 6; i >= 0; i--) {
      const date = new Date(now);
      date.setDate(now.getDate() - i);
      const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
      
      const dayStart = new Date(date);
      dayStart.setHours(0, 0, 0, 0);
      const dayEnd = new Date(dayStart);
      dayEnd.setDate(dayEnd.getDate() + 1);
      
      const count = data.timeStats.filter(stat => {
        const statDate = new Date(stat.timestamp);
        return statDate >= dayStart && statDate < dayEnd;
      }).length;
      
      dailyData.push({
        name: dateStr,
        cigarettes: count
      });
    }
    
    return dailyData;
  };
  
  const getHourlyChartData = () => {
    const hourlyStats = new Array(24).fill(0);
    
    data.timeStats.forEach(stat => {
      const statDate = new Date(stat.timestamp);
      const hour = statDate.getHours();
      hourlyStats[hour]++;
    });
    
    return hourlyStats.map((count, hour) => ({
      name: `${hour}:00`,
      cigarettes: count
    }));
  };
  
  const getSpendingChartData = () => {
    const now = new Date();
    const spendingData = [];
    const costPerCigarette = data.packPrice / data.cigarettesPerPack;
    
    for (let i = 6; i >= 0; i--) {
      const date = new Date(now);
      date.setDate(now.getDate() - i);
      const dateStr = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });
      
      const dayStart = new Date(date);
      dayStart.setHours(0, 0, 0, 0);
      const dayEnd = new Date(dayStart);
      dayEnd.setDate(dayEnd.getDate() + 1);
      
      const count = data.timeStats.filter(stat => {
        const statDate = new Date(stat.timestamp);
        return statDate >= dayStart && statDate < dayEnd;
      }).length;
      
      spendingData.push({
        name: dateStr,
        spending: parseFloat((count * costPerCigarette).toFixed(2))
      });
    }
    
    return spendingData;
  };
  
  const renderChart = () => {
    let chartData = [];
    let dataKey = 'cigarettes';
    let yAxisLabel = '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ';
    
    switch (activeChart) {
      case 'weekday':
        chartData = getWeekdayChartData();
        break;
      case 'daily':
        chartData = getDailyChartData();
        break;
      case 'hourly':
        chartData = getHourlyChartData();
        break;
      case 'spending':
        chartData = getSpendingChartData();
        dataKey = 'spending';
        yAxisLabel = '–†–∞—Å—Ö–æ–¥—ã (‚ÇΩ)';
        break;
      default:
        chartData = getWeekdayChartData();
    }
    
    return (
      <div className="h-64 w-full">
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
            <CartesianGrid strokeDasharray="3 3" stroke="rgba(255, 255, 255, 0.1)" />
            <XAxis 
              dataKey="name" 
              stroke="rgba(255, 255, 255, 0.7)"
              tick={{ fill: 'rgba(255, 255, 255, 0.9)', fontSize: 12 }}
            />
            <YAxis 
              stroke="rgba(255, 255, 255, 0.7)"
              tick={{ fill: 'rgba(255, 255, 255, 0.7)' }}
              label={{ 
                value: yAxisLabel, 
                angle: -90, 
                position: 'insideLeft',
                fill: 'rgba(255, 255, 255, 0.7)',
                fontSize: 12
              }}
            />
            <Tooltip 
              contentStyle={{ 
                backgroundColor: 'rgba(30, 41, 59, 0.9)', 
                border: 'none',
                borderRadius: '8px'
              }}
              labelStyle={{ color: 'white' }}
              formatter={(value) => [`${value} ${activeChart === 'spending' ? '‚ÇΩ' : ''}`, '–ó–Ω–∞—á–µ–Ω–∏–µ']}
              labelFormatter={(label) => `–î–∞—Ç–∞: ${label}`}
            />
            <Bar 
              dataKey={dataKey} 
              fill={activeChart === 'spending' ? '#ef4444' : '#3b82f6'}
              radius={[4, 4, 0, 0]}
            />
          </BarChart>
        </ResponsiveContainer>
      </div>
    );
  };
  
  // Rendering helper components
  const renderAchievements = () => (
    <div className="space-y-2">
      {data.achievements.map(achievement => (
        <div 
          key={achievement.id}
          className={`flex items-start p-3 rounded-lg ${achievement.achieved ? 'bg-green-900/30' : 'bg-white/5'}`}
        >
          <div className="text-2xl mr-3 mt-1">{achievement.icon}</div>
          <div>
            <div className="font-bold">{achievement.name}</div>
            <div className="text-sm opacity-80">{achievement.description}</div>
          </div>
        </div>
      ))}
    </div>
  );
  
  const renderTimeDetails = (period) => {
    if (!timeDetails[period]) return null;
    
    let filteredStats = [];
    const now = new Date();
    
    if (period === 'week') {
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      weekAgo.setHours(0, 0, 0, 0);
      
      filteredStats = data.timeStats.filter(stat => {
        const statDate = new Date(stat.timestamp);
        return statDate >= weekAgo && statDate <= now;
      });
    } 
    else if (period === 'month') {
      const monthAgo = new Date();
      monthAgo.setDate(monthAgo.getDate() - 30);
      monthAgo.setHours(0, 0, 0, 0);
      
      filteredStats = data.timeStats.filter(stat => {
        const statDate = new Date(stat.timestamp);
        return statDate >= monthAgo && statDate <= now;
      });
    }
    else if (period === 'all') {
      filteredStats = [...data.timeStats];
    }
    
    const sortedStats = [...filteredStats].sort((a, b) => b.timestamp - a.timestamp);
    
    return (
      <div className="bg-black/20 rounded-lg p-3 mt-2 max-h-48 overflow-y-auto">
        {sortedStats.length > 0 ? (
          sortedStats.map((stat, index) => {
            const statDate = new Date(stat.timestamp);
            return (
              <div key={index} className="py-1 border-b border-white/10 last:border-0">
                {statDate.toLocaleTimeString('ru-RU')} - {statDate.toLocaleDateString('ru-RU')}
              </div>
            );
          })
        ) : (
          <div className="py-2 text-center opacity-70">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
        )}
      </div>
    );
  };
  
  const renderMedicalFact = () => {
    if (!data.lastCigaretteTime) return null;
    
    const now = new Date();
    const lastTime = new Date(data.lastCigaretteTime);
    const diffHours = Math.floor((now - lastTime) / (1000 * 60 * 60));
    
    if (diffHours >= 1 && diffHours <= 24) {
      return (
        <div className="bg-black/20 rounded-lg p-3 mt-2 text-sm">
          {medicalFacts[diffHours - 1]}
        </div>
      );
    } else if (diffHours > 24) {
      return (
        <div className="bg-black/20 rounded-lg p-3 mt-2 text-sm">
          –ë–æ–ª–µ–µ 24 —á–∞—Å–æ–≤ –±–µ–∑ —Å–∏–≥–∞—Ä–µ—Ç! –û—Ä–≥–∞–Ω–∏–∑–º –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è!
        </div>
      );
    }
    
    return null;
  };
  
  if (!user) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-900 via-red-900 to-blue-900 flex items-center justify-center p-4">
        <div className="text-white text-center">
          <div className="text-2xl font-bold mb-4">SmokeLess</div>
          <p className="mb-6 opacity-80">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
          <button
            onClick={() => setShowAuthModal(true)}
            className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 shadow-lg"
          >
            –ù–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å
          </button>
        </div>
      </div>
    );
  }
  
  const progressInfo = getProgressInfo();
  
  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-900 via-red-900 to-blue-900 text-white">
      {/* Sync Status Indicator */}
      {syncStatus.status !== 'idle' && (
        <div className={`fixed top-4 right-4 px-4 py-2 rounded-full text-sm font-medium flex items-center space-x-2 ${
          syncStatus.status === 'syncing' ? 'bg-blue-500' :
          syncStatus.status === 'success' ? 'bg-green-500' :
          'bg-red-500'
        }`}>
          {syncStatus.status === 'syncing' && <Zap className="w-4 h-4" />}
          {syncStatus.status === 'success' && <CheckCircle className="w-4 h-4" />}
          {syncStatus.status === 'error' && <XCircle className="w-4 h-4" />}
          <span>{syncStatus.message}</span>
        </div>
      )}
      
      <div className="max-w-2xl mx-auto p-4 min-h-screen">
        {/* User Panel */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-4">
          <div className="flex justify-between items-center">
            <div className="flex items-center space-x-3">
              <div className="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center font-bold">
                {user.email.charAt(0).toUpperCase()}
              </div>
              <div>
                <div className="font-medium">{user.name}</div>
                <div className="text-xs opacity-70">{user.email}</div>
              </div>
            </div>
            <button
              onClick={() => setShowSettings(true)}
              className="p-2 hover:bg-white/20 rounded-full transition-colors"
              title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
            >
              <Settings className="w-5 h-5" />
            </button>
          </div>
        </div>
        
        <div className="flex justify-between items-center mb-6">
          <div>
            <h1 className="text-2xl font-bold">–°—á–µ—Ç—á–∏–∫ —Å–∏–≥–∞—Ä–µ—Ç</h1>
            <p className="text-sm opacity-80 mt-1">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –∏ —Ä–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º –∑–¥–æ—Ä–æ–≤—å—è</p>
          </div>
          <button
            onClick={() => setShowStatsModal(true)}
            className="p-2 hover:bg-white/20 rounded-full transition-colors"
            title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
          >
            <BarChart2 className="w-6 h-6" />
          </button>
        </div>
        
        {/* Counter Card */}
        <motion.div 
          className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-white/20"
          whileHover={{ scale: 1.01 }}
          transition={{ type: "spring", stiffness: 300 }}
        >
          <h2 className="text-lg font-medium mb-3">–°–µ–≥–æ–¥–Ω—è –≤—ã–∫—É—Ä–µ–Ω–Ω—ã—Ö —Å–∏–≥–∞—Ä–µ—Ç</h2>
          <div className="text-5xl font-bold mb-6 text-center">
            {data.today}
          </div>
          <div className="flex flex-col sm:flex-row gap-4 mb-4">
            <button
              onClick={incrementCounter}
              className="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg"
            >
              <Plus className="mr-2" /> –î–æ–±–∞–≤–∏—Ç—å
            </button>
            <button
              onClick={decrementCounter}
              className="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg"
            >
              <Minus className="mr-2" /> –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
          <button
            onClick={performAutoReset}
            className="text-pink-400 hover:text-pink-300 text-sm transition-colors w-full mt-2"
          >
            –ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–Ω—å
          </button>
        </motion.div>
        
        {/* Progress Bar */}
        <div className={`bg-white/10 backdrop-blur-sm rounded-xl p-4 mb-6 border border-white/20 ${
          progressInfo.isCritical ? 'animate-pulse bg-red-900/20' : ''
        }`}>
          <div className="flex justify-between items-center mb-3">
            <h3 className="font-medium">{progressInfo.message}</h3>
            <span className="font-bold">{progressInfo.percent}%</span>
          </div>
          <div className="w-full bg-white/20 rounded-full h-3 overflow-hidden">
            <motion.div
              className={`h-full ${getProgressBarColor(progressInfo.percent)}`}
              initial={{ width: 0 }}
              animate={{ width: `${progressInfo.percent}%` }}
              transition={{ duration: 0.5 }}
            />
          </div>
          <p className="mt-2 text-sm opacity-80">
            –¶–µ–ª—å: <span className="font-bold">{data.goal}</span> —Å–∏–≥–∞—Ä–µ—Ç –≤ –¥–µ–Ω—å
          </p>
        </div>
        
        {/* Timer */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-5 mb-6 text-center border border-white/20">
          <h3 className="font-medium mb-2">–í—Ä–µ–º—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–≥–∞—Ä–µ—Ç—ã</h3>
          <div className="text-3xl font-bold mb-2 text-green-400">
            {data.lastCigaretteTime ? (
              (() => {
                const now = new Date();
                const lastTime = new Date(data.lastCigaretteTime);
                const diff = now - lastTime;
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
              })()
            ) : '00:00:00'}
          </div>
          <p className="text-sm opacity-80">
            –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–≥–∞—Ä–µ—Ç–∞: {data.lastCigaretteTime ? new Date(data.lastCigaretteTime).toLocaleTimeString('ru-RU') : '--:--:--'}
          </p>
          {renderMedicalFact()}
        </div>
        
        {/* Statistics Grid */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          {[{
            id: 'week',
            label: '–ó–∞ –Ω–µ–¥–µ–ª—é',
            value: data.week,
            icon: Clock
          }, {
            id: 'month',
            label: '–ó–∞ –º–µ—Å—è—Ü',
            value: data.month,
            icon: Clock
          }, {
            id: 'all',
            label: '–ó–∞ –≤—Å—ë –≤—Ä–µ–º—è',
            value: data.timeStats.length,
            icon: Database,
            sublabel: data.timeStats.length > 0 
              ? `—Å ${new Date(Math.min(...data.timeStats.map(s => s.timestamp))).toLocaleDateString('ru-RU')}`
              : ''
          }].map((stat) => (
            <motion.div
              key={stat.id}
              className="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center border border-white/20 cursor-pointer"
              whileHover={{ y: -2 }}
              onClick={() => setTimeDetails(prev => ({
                ...prev,
                [stat.id]: !prev[stat.id]
              }))}
            >
              <stat.icon className="w-6 h-6 mx-auto mb-2 text-blue-400" />
              <div className="text-2xl font-bold mb-1">{stat.value}</div>
              <div className="text-sm opacity-80">{stat.label}</div>
              {stat.sublabel && (
                <div className="text-xs opacity-60 mt-1">{stat.sublabel}</div>
              )}
              {renderTimeDetails(stat.id)}
            </motion.div>
          ))}
        </div>
        
        {/* Costs */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-5 mb-6 text-center border border-white/20">
          <h3 className="font-medium mb-2 flex items-center justify-center">
            <DollarSign className="mr-2" /> –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ —Å–∏–≥–∞—Ä–µ—Ç—ã
          </h3>
          <div className="text-3xl font-bold mb-2 text-red-400">
            {Math.round(data.totalCost)} ‚ÇΩ
          </div>
          <p className="text-sm opacity-80">
            –ü—Ä–∏ —Ü–µ–Ω–µ –ø–∞—á–∫–∏ <span className="font-bold">{data.packPrice} ‚ÇΩ</span>
          </p>
          <p className="text-xs opacity-70 mt-1">
            –° {new Date(data.firstUseDate).toLocaleDateString('ru-RU')}
          </p>
        </div>
        
        {/* Quote */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-5 mb-6 text-center italic border border-white/20 min-h-[70px] flex items-center justify-center">
          <p className="text-sm">"{randomQuote}"</p>
        </div>
        
        {/* Achievements */}
        <div className="bg-white/10 backdrop-blur-sm rounded-xl p-5 mb-6 border border-white/20">
          <div className="flex justify-between items-center mb-4">
            <h3 className="font-medium flex items-center">
              <Medal className="mr-2" /> –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            </h3>
            <span className="text-sm opacity-70">
              {data.achievements.filter(a => a.achieved).length}/{data.achievements.length}
            </span>
          </div>
          {renderAchievements()}
        </div>
        
        <footer className="text-center py-4 opacity-70 text-xs mt-auto">
          <p>SmokeLess - Smoking Tracker App by Artuasova | ¬© 2025 Ver.0.8</p>
        </footer>
      </div>
      
      {/* Settings Modal */}
      {showSettings && (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
          <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 w-full max-w-md border border-white/20">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
              <button onClick={() => setShowSettings(false)} className="text-xl">&times;</button>
            </div>
            
            <div className="space-y-4 mb-6">
              <div>
                <label className="block mb-1 font-medium">–¶–µ–ª—å (—Å–∏–≥–∞—Ä–µ—Ç –≤ –¥–µ–Ω—å):</label>
                <input
                  type="number"
                  value={data.goal}
                  onChange={(e) => setData(prev => ({ ...prev, goal: parseInt(e.target.value) || 20 }))}
                  className="w-full bg-white/5 border border-white/20 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-green-500"
                />
              </div>
              
              <div>
                <label className="block mb-1 font-medium">–¶–µ–Ω–∞ –ø–∞—á–∫–∏ (‚ÇΩ):</label>
                <input
                  type="number"
                  value={data.packPrice}
                  onChange={(e) => setData(prev => ({ ...prev, packPrice: parseInt(e.target.value) || 250 }))}
                  className="w-full bg-white/5 border border-white/20 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-green-500"
                />
              </div>
              
              <div>
                <label className="block mb-1 font-medium">–°–∏–≥–∞—Ä–µ—Ç –≤ –ø–∞—á–∫–µ:</label>
                <input
                  type="number"
                  value={data.cigarettesPerPack}
                  onChange={(e) => setData(prev => ({ ...prev, cigarettesPerPack: parseInt(e.target.value) || 20 }))}
                  className="w-full bg-white/5 border border-white/20 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-green-500"
                />
              </div>
            </div>
            
            <div className="space-y-3">
              <button
                onClick={() => {/* Export logic */}}
                className="w-full bg-blue-500/20 hover:bg-blue-500/30 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center"
              >
                <Download className="mr-2" /> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
              </button>
              
              <button
                onClick={() => {
                  if (window.confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    if (window.confirm('–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –í–°–ï –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                      setData({
                        today: 0,
                        week: 0,
                        month: 0,
                        goal: 20,
                        packPrice: 250,
                        cigarettesPerPack: 20,
                        streak: 0,
                        lastDate: null,
                        timeStats: [],
                        lastAutoResetDate: new Date().toDateString(),
                        achievements: [
                          { id: 1, name: "–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å", target: 1, achieved: false, icon: "üìÖ" },
                          { id: 2, name: "–ù–µ–¥–µ–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—é", target: 7, achieved: false, icon: "üóìÔ∏è" },
                          { id: 3, name: "–ú–µ—Å—è—Ü –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è", description: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–µ—Å—è—Ü", target: 30, achieved: false, icon: "üìÜ" },
                          { id: 4, name: "100 —Å–∏–≥–∞—Ä–µ—Ç", description: "–í—ã–∫—É—Ä–∏—Ç—å 100 —Å–∏–≥–∞—Ä–µ—Ç", target: 100, achieved: false, icon: "üö¨" },
                          { id: 5, name: "–≠–∫–æ–Ω–æ–º–∏—è –∑–¥–æ—Ä–æ–≤—å—è", description: "–°–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –Ω–∞ 50% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –Ω–µ–¥–µ–ª–µ–π", target: 50, achieved: false, icon: "üíö" }
                        ],
                        totalCost: 0,
                        usageDays: 0,
                        firstUseDate: new Date().toDateString(),
                        lastCigaretteTime: null
                      });
                    }
                  }
                }}
                className="w-full bg-red-500/20 hover:bg-red-500/30 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center"
              >
                <Trash2 className="mr-2" /> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë
              </button>
              
              <button
                onClick={() => window.location.reload()}
                className="w-full bg-yellow-500/20 hover:bg-yellow-500/30 text-white font-medium py-2 px-4 rounded-lg transition-colors flex items-center justify-center"
              >
                <RefreshCw className="mr-2" /> –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
              </button>
              
              <button
                onClick={saveData}
                className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors"
              >
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
              </button>
              
              <button
                onClick={logout}
                className="w-full bg-pink-500/20 hover:bg-pink-500/30 text-pink-300 font-medium py-2 px-4 rounded-lg transition-colors mt-2"
              >
                <LogOut className="mr-2 inline" /> –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
              </button>
            </div>
          </div>
        </div>
      )}
      
      {/* Stats Modal */}
      {showStatsModal && (
        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
          <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 w-full max-w-md border border-white/20 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-bold flex items-center">
                <BarChart2 className="mr-2" /> –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
              </h2>
              <button onClick={() => setShowStatsModal(false)} className="text-xl">&times;</button>
            </div>
            
            <div className="flex flex-wrap justify-center gap-1 mb-6">
              {['weekday', 'daily', 'hourly', 'spending'].map((chart) => (
                <button
                  key={chart}
                  onClick={() => setActiveChart(chart)}
                  className={`px-3 py-1 rounded-full text-sm font-medium transition-colors ${
                    activeChart === chart
                      ? 'bg-green-500 text-white'
                      : 'bg-white/10 hover:bg-white/20'
                  }`}
                >
                  {chart === 'weekday' && '–î–Ω–∏ –Ω–µ–¥–µ–ª–∏'}
                  {chart === 'daily' && '–ü–æ –¥–Ω—è–º'}
                  {chart === 'hourly' && '–ü–æ —á–∞—Å–∞–º'}
                  {chart === 'spending' && '–†–∞—Å—Ö–æ–¥—ã'}
                </button>
              ))}
            </div>
            
            {renderChart()}
            
            <div className="flex justify-between text-xs opacity-70 mt-2">
              <span>{activeChart === 'spending' ? '–†–∞—Å—Ö–æ–¥—ã (‚ÇΩ)' : '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'}</span>
              <span>
                {activeChart === 'weekday' && '–î–Ω–∏ –Ω–µ–¥–µ–ª–∏'}
                {activeChart === 'daily' && '–î–∞—Ç–∞'}
                {activeChart === 'hourly' && '–ß–∞—Å—ã'}
                {activeChart === 'spending' && '–î–∞—Ç–∞'}
              </span>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default App;
